library(knitr)
library(dplyr)
library(reshape2)
####################################################################################################
#Data Manipulation #
####################################################################################################
# read main data sheet
all <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Preliminary CVD cytokine data/Jenny manifest v4 GRP2 9th Jan 2019.csv",na.strings = c("","NA"," "))
# delete records with missing data
all <- all[!is.na(all$IFN.g),]
# read in randomization
rand <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Preliminary CVD cytokine data/metformin vs placebo.csv")
# merge datasets
alldata <- merge(all,rand,by=c("ANALYTICID"))
# get rid of unneeded variables
alldata <- select(alldata,-c("RN","PARENT_ID","SAMPLE_ID","STORAGETYPE","SAMPLEGROUP","BOX.ID","NO.","ROW","COL","pg.ml","X"))
# assign variable for pre vs. post treatment
alldata <- alldata[order(alldata$ANALYTICID,alldata$COLLECTIONDT),]
alldata <- alldata %>% group_by(ANALYTICID) %>% mutate(id=row_number())
View(alldata)
# calculate deltas
mdata <- reshape(data=alldata,idvar="ANALYTICID",timevar="id",direction="wide")
View(mdata)
# calculate deltas
mdata <- cast(alldata,ANALYTICID ~ id)
library(reshape)
install.packages("reshape")
library(reshape)
library(reshape)
# calculate deltas
mdata <- cast(alldata,ANALYTICID ~ id)
help(cast)
View(alldata)
# calculate deltas
mdata <- cast(alldata,ANALYTICID ~ id)
View(alldata)
# calculate deltas
wide <- reshape(alldata,timevar="id",idvar=c("ANALYTICID","Treatment.Group"),direction="wide")
View(wide)
class(alldata$id)
alldata$id <- as.character(alldata$id)
View(alldata)
# calculate deltas
wide <- reshape(alldata,timevar="id",idvar=c("ANALYTICID","Treatment.Group"),direction="wide")
View(wide)
View(alldata)
library(tidyr)
# calculate deltas
wide <- spread(alldata,id)
help(spread)
# calculate deltas
wide <- spread(alldata,id,IFN.g)
View(wide)
library(reshape2)
# calculate deltas
wide <- dcast(alldata,ANALYTICID + Treatment.Group ~ id)
View(wide)
View(alldata)
# calculate deltas
wide <- dcast(alldata,ANALYTICID + Treatment.Group ~ id, value.var = c("IFN.g","IL.1b"))
View(wide)
# calculate deltas
wide <- dcast(melt(alldata,id.vars=c("ANALYTIC.ID","ID","Treatment.Group"),ANALYTICID ~ variable + ID))
# calculate deltas
wide <- dcast(melt(alldata,id.vars=c("ANALYTIC.ID","ID","Treatment.Group")),ANALYTICID ~ variable + ID)
# calculate deltas
wide <- dcast(melt(alldata,id.vars=c("ANALYTICID","ID","Treatment.Group")),ANALYTICID ~ variable + ID)
# calculate deltas
wide <- dcast(melt(alldata,id.vars=c("ANALYTICID","id","Treatment.Group")),ANALYTICID ~ variable + ID)
# calculate deltas
wide <- dcast(melt(alldata,id.vars=c("ANALYTICID","id","Treatment.Group")),ANALYTICID ~ variable + id)
# calculate deltas
wide <- dcast(melt(alldata,id.vars=c("ANALYTICID","id","Treatment.Group")),ANALYTICID ~ id)
library(data.table)
View(alldata)
# calculate deltas
wide <- dcast(alldata,ANALYTICID + Treatment.Group ~ id, value.var=c("IFN.g","IL.1b"))
# calculate deltas
wide <- dcast(alldata,ANALYTICID  ~ id, value.var=c("IFN.g","IL.1b"))
table(alldata$ANALYTICID,alldata$id)
# calculate deltas
alldata$ANALYTICID <- factor(alldata$ANALYTICID)
wide <- dcast(alldata,ANALYTICID  ~ id, value.var=c("IFN.g","IL.1b"))
table(alldata$ANALYTICID,alldata$id)
wide <- dcast(alldata,ANALYTICID  ~ as.factor(id), value.var=c("IFN.g","IL.1b"))
wide <- data.table::dcast(alldata,ANALYTICID  ~ as.factor(id), value.var=c("IFN.g","IL.1b"))
library(knitr)
library(dplyr)
library(data.table)
library(tidyr)
####################################################################################################
#Data Manipulation #
####################################################################################################
# read main data sheet
all <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Preliminary CVD cytokine data/Jenny manifest v4 GRP2 9th Jan 2019.csv",na.strings = c("","NA"," "))
# delete records with missing data
all <- all[!is.na(all$IFN.g),]
# read in randomization
rand <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Preliminary CVD cytokine data/metformin vs placebo.csv")
# merge datasets
alldata <- merge(all,rand,by=c("ANALYTICID"))
# get rid of unneeded variables
alldata <- select(alldata,-c("RN","PARENT_ID","SAMPLE_ID","STORAGETYPE","SAMPLEGROUP","BOX.ID","NO.","ROW","COL","pg.ml","X"))
# assign variable for pre vs. post treatment
alldata <- alldata[order(alldata$ANALYTICID,alldata$COLLECTIONDT),]
alldata <- alldata %>% group_by(ANALYTICID) %>% mutate(id=row_number())
alldata$prepost[alldata$id==1] <- "PRE"
alldata$prepost[alldata$id==2] <- "POST"
View(alldata)
test <- alldata[,c("ANALYTICID","IFN.g","prepost")]
test <- alldata[,c("ANALYTICID","IFN.g","prepost")]
wide <- reshape(test,v.names = "IFN.g",idvar="ANALYTICID",timevar="prepost",direction="wide")
View(wide)
# read main data sheet
all <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Preliminary CVD cytokine data/Jenny manifest v4 GRP2 9th Jan 2019.csv",na.strings = c("","NA"," "))
# delete records with missing data
all <- all[!is.na(all$IFN.g),]
source("C:/Users/pylell/Documents/GitHub/General-code/temp_table1.r")
# read in randomization
rand <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Preliminary CVD cytokine data/metformin vs placebo.csv")
# merge datasets
alldata <- merge(all,rand,by=c("ANALYTICID"))
# get rid of unneeded variables
alldata <- select(alldata,-c("RN","PARENT_ID","SAMPLE_ID","STORAGETYPE","SAMPLEGROUP","BOX.ID","NO.","ROW","COL","pg.ml","X"))
library(knitr)
library(dplyr)
library(data.table)
library(tidyr)
library(Hmisc)
####################################################################################################
#Data Manipulation #
####################################################################################################
# read main data sheet
all <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Preliminary CVD cytokine data/Jenny manifest v4 GRP2 9th Jan 2019.csv",na.strings = c("","NA"," "))
# delete records with missing data
all <- all[!is.na(all$IFN.g),]
source("C:/Users/pylell/Documents/GitHub/General-code/temp_table1.r")
# read in randomization
rand <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Preliminary CVD cytokine data/metformin vs placebo.csv")
# merge datasets
alldata <- merge(all,rand,by=c("ANALYTICID"))
# get rid of unneeded variables
alldata <- select(alldata,-c("RN","PARENT_ID","SAMPLE_ID","STORAGETYPE","SAMPLEGROUP","BOX.ID","NO.","ROW","COL","pg.ml","X"))
# assign variable for pre vs. post treatment
alldata <- alldata[order(alldata$ANALYTICID,alldata$COLLECTIONDT),]
alldata <- alldata %>% group_by(ANALYTICID) %>% mutate(id=row_number())
alldata$prepost[alldata$id==1] <- "PRE"
alldata$prepost[alldata$id==2] <- "POST"
# Tim deltas
nums <- unlist(lapply(alldata, is.numeric))
deltas <- alldata[alldata$prepost == "POST",nums] - alldata[alldata$prepost == "PRE",nums]
deltas$ANALYTICID <- alldata$ANALYTICID[alldata$prepost == "PRE"]
# merge datasets
deltas <- merge(deltas,rand,by=c("ANALYTICID"))
# labels
label(deltas$IFN.g)="Change in IFN-g"
label(deltas$IL.1b)="Change in IL.1b"
label(deltas$IL.12.IL.23p40)="Change in IL.12.IL.23p40"
label(deltas$IL.17A)="Change in IL.17A"
label(deltas$IL.18)="Change in IL.18"
label(deltas$IL.6)="Change in IL.6"
label(deltas$IL.8)="Change in IL.8"
label(deltas$MCP.1..Human.)="Change in MCP.1..Human."
label(deltas$TNF.a)="Change in TNF.a"
# compare deltas in the treatment groups
table <- final_table(deltas,c("IFN.g","IL.1b","IL.12.IL.23p40","IL.17A","IL.18","IL.6","IL.8","MCP.1..Human.","TNF.a"),
group=as.factor(deltas$Treatment.Group),margin=2,single=0,ron=2)
table
N <- nrow(deltas)
N
library(lubridate)
library(dplyr)
library(tableone)
library(knitr)
library(data.table)
library(tidyr)
library(Hmisc)
####  PROTEOMICS DATA ######
filename <- "H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Data/Proteomics data/experimentcodes.csv"
codes <- read.csv(filename)
filename <-  "H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Data/Proteomics data//proteinquant.csv"
proteins <- read.csv(filename,header = FALSE)
# Transpose and format protein concentration data
proteins <- t(proteins)
proteins[1,1] <- "subjectid"
colnames(proteins) <- proteins[1,]
proteins <- proteins[-1,]
rownames(proteins) <- 1:nrow(proteins)
proteins <- as.data.frame(proteins)
# Get protein subjcet ids
proteins$subjectid <- substr(proteins$subjectid,7,8)
proteins[,2:ncol(proteins)] <- sapply(proteins[,2:ncol(proteins)],function(x) as.numeric(as.character(x)))
# Add subject id, date, etc.
groups <- codes[,c("MS.ID","ANALYTICID","COLLECTIONDT","SAMPLEGROUP")]
colnames(groups) <- c("subjectid","analyticid","date","group")
proteins <- merge(proteins,groups,by = "subjectid")
proteins$group <- ifelse(proteins$group == "Group 3","Metformin","Placebo")
proteins$date <- mdy(proteins$date)
# DROP GROUP - WILL GET THIS FROM THE RANDOMIZATION FILE
proteins <- subset(proteins,select=-c(group))
View(proteins)
####  CYTOKINE DATA ######
all <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Data/Preliminary CVD cytokine data/Jenny manifest v4 GRP2 9th Jan 2019.csv",na.strings = c("","NA"," ","error"))
# delete records with missing data
all <- all[!is.na(all$IFN.g),]
# get rid of unneeded variables
cytokine <- select(all,-c("RN","PARENT_ID","SAMPLE_ID","STORAGETYPE","SAMPLEGROUP","BOX.ID","NO.","ROW","COL","pg.ml","X"))
View(cytokine)
colnames(cytokine$COLLECTIONDT) <- "date"
####  CYTOKINE DATA ######
all <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Data/Preliminary CVD cytokine data/Jenny manifest v4 GRP2 9th Jan 2019.csv",na.strings = c("","NA"," ","error"))
# delete records with missing data
all <- all[!is.na(all$IFN.g),]
cytokine$date <- cytokine$COLLECTIONDT
# get rid of unneeded variables
cytokine <- select(all,-c("RN","PARENT_ID","SAMPLE_ID","STORAGETYPE","SAMPLEGROUP","BOX.ID","NO.","ROW","COL","pg.ml","X","COLLECTIONDT"))
View(cytokine)
####  CYTOKINE DATA ######
all <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Data/Preliminary CVD cytokine data/Jenny manifest v4 GRP2 9th Jan 2019.csv",na.strings = c("","NA"," ","error"))
# delete records with missing data
cytokine <- all[!is.na(all$IFN.g),]
cytokine$date <- cytokine$COLLECTIONDT
# get rid of unneeded variables
cytokine <- select(all,-c("RN","PARENT_ID","SAMPLE_ID","STORAGETYPE","SAMPLEGROUP","BOX.ID","NO.","ROW","COL","pg.ml","X","COLLECTIONDT"))
####  CYTOKINE DATA ######
all <- read.csv("H:/Endocrinology/Nadeau/T1D Excha
)
####  CYTOKINE DATA ######
all <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Data/Preliminary CVD cytokine data/Jenny manifest v4 GRP2 9th Jan 2019.csv",na.strings = c("","NA"," ","error"))
# delete records with missing data
cytokine <- all[!is.na(all$IFN.g),]
cytokine$date <- cytokine$COLLECTIONDT
# get rid of unneeded variables
cytokine <- select(all,-c("RN","PARENT_ID","SAMPLE_ID","STORAGETYPE","SAMPLEGROUP","BOX.ID","NO.","ROW","COL","pg.ml","X","COLLECTIONDT"))
####  CYTOKINE DATA ######
all <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Data/Preliminary CVD cytokine data/Jenny manifest v4 GRP2 9th Jan 2019.csv",na.strings = c("","NA"," ","error"))
# delete records with missing data
cytokine <- all[!is.na(all$IFN.g),]
cytokine$date <- cytokine$COLLECTIONDT
# get rid of unneeded variables
cytokine <- select(cytokine,-c("RN","PARENT_ID","SAMPLE_ID","STORAGETYPE","SAMPLEGROUP","BOX.ID","NO.","ROW","COL","pg.ml","X","COLLECTIONDT"))
dim(cytokine)
dim(protein)
dim(proteins)
# merge cytokine data and protein data and check if there are any records in one but not the other
cytokine_protein <- merge(cytokine, protein, by=c("analyticid","date"))
# merge cytokine data and protein data and check if there are any records in one but not the other
cytokine_protein <- merge(cytokine, proteins, by=c("analyticid","date"))
####  CYTOKINE DATA ######
all <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Data/Preliminary CVD cytokine data/Jenny manifest v4 GRP2 9th Jan 2019.csv",na.strings = c("","NA"," ","error"))
# delete records with missing data
cytokine <- all[!is.na(all$IFN.g),]
cytokine$date <- cytokine$COLLECTIONDT
cytokine$analyticid <- cytokine$ANALYTICID
# get rid of unneeded variables
cytokine <- select(cytokine,-c("RN","PARENT_ID","SAMPLE_ID","STORAGETYPE","SAMPLEGROUP","BOX.ID","NO.","ROW","COL","pg.ml","X",
"COLLECTIONDT","ANALYTICID"))
# merge cytokine data and protein data and check if there are any records in one but not the other
cytokine_protein <- merge(cytokine, proteins, by=c("analyticid","date"))
class(cytokine$analyticid)
class(cytokine$date)
class(proteins$date)
class(proteins$analyticid)
cytokine$date <- mdy(cytokine$date)
####  CYTOKINE DATA ######
all <- read.csv("H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Data/Preliminary CVD cytokine data/Jenny manifest v4 GRP2 9th Jan 2019.csv",na.strings = c("","NA"," ","error"))
# delete records with missing data
cytokine <- all[!is.na(all$IFN.g),]
cytokine$date <- cytokine$COLLECTIONDT
cytokine$analyticid <- cytokine$ANALYTICID
# get rid of unneeded variables
cytokine <- select(cytokine,-c("RN","PARENT_ID","SAMPLE_ID","STORAGETYPE","SAMPLEGROUP","BOX.ID","NO.","ROW","COL","pg.ml","X",
"COLLECTIONDT","ANALYTICID"))
cytokine$date <- mdy(cytokine$date)
# merge cytokine data and protein data and check if there are any records in one but not the other
cytokine_protein <- merge(cytokine, proteins, by=c("analyticid","date"))
View(cytokine_protein)
# merge cytokine data and protein data and check if there are any records in one but not the other
cytokine_protein <- merge(cytokine, proteins, by=c("analyticid","date"),all.x = TRUE,all.y = TRUE)
View(cytokine_protein[,c("analyticid","date","IFN.g","subjectid")])
View(cytokine_protein[,c("analyticid","date","IFN.g","subjectid")])
names(proteins)
View(cytokine_protein[,c("analyticid","date","IFN.g","sp|P01024|CO3_HUMAN")])
test <- cytokine_protein[,c("analyticid","date","IFN.g","sp|P01024|CO3_HUMAN")]
write.csv(test,"H:/Endocrinology/Nadeau/T1D Exchange metformin and lipids/Data/checking cytokine protein dates.csv")
View(cytokine)
proteins <- read.csv(filename,header = FALSE)
# Transpose and format protein concentration data
proteins <- t(proteins)
proteins[1,1] <- "subjectid"
colnames(proteins) <- proteins[1,]
proteins <- proteins[-1,]
rownames(proteins) <- 1:nrow(proteins)
proteins <- as.data.frame(proteins)
# Get protein subjcet ids
proteins$subjectid <- substr(proteins$subjectid,7,8)
proteins[,2:ncol(proteins)] <- sapply(proteins[,2:ncol(proteins)],function(x) as.numeric(as.character(x)))
# Add subject id, date, etc.
groups <- codes[,c("MS.ID","ANALYTICID","COLLECTIONDT","SAMPLEGROUP")]
